<section class="vb-main-collection page-width">
  {% if collection == nil %}
    <p>This section requires a collection template context.</p>
  {% else %}
    {% if section.settings.show_collection_image and collection.image %}
      <div class="vb-main-collection__hero">
        {{
          collection.image
          | image_url: width: 1800
          | image_tag:
            loading: 'lazy',
            widths: '600,900,1200,1500,1800',
            sizes: '100vw',
            alt: collection.title
        }}
      </div>
    {% endif %}

    <header class="vb-main-collection__header">
      <h1>{{ collection.title }}</h1>
      {% if collection.description != blank %}
        <div class="vb-main-collection__description rte">{{ collection.description }}</div>
      {% endif %}
    </header>

    {% paginate collection.products by section.settings.products_per_page %}
      {% liquid
        assign regular_count = 0
        assign bundle_count = 0
        for product in collection.products
          assign tags_down = product.tags | join: ',' | downcase
          if tags_down contains 'bundle'
            assign bundle_count = bundle_count | plus: 1
          else
            assign regular_count = regular_count | plus: 1
          endif
        endfor
      %}

      {% if regular_count > 0 %}
        <div class="vb-main-collection__section">
          {% if section.settings.products_heading != blank %}
            <h2 class="vb-main-collection__section-title">{{ section.settings.products_heading }}</h2>
          {% endif %}
          <div class="vb-main-collection__grid">
            {% for product in collection.products %}
              {% assign tags_down = product.tags | join: ',' | downcase %}
              {% unless tags_down contains 'bundle' %}
                {% render 'product-card',
                  product: product,
                  cta_label: section.settings.product_cta_label
                %}
              {% endunless %}
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if bundle_count > 0 %}
        <div class="vb-main-collection__bundles">
          <div class="vb-main-collection__divider" aria-hidden="true"></div>
          {% if section.settings.bundles_heading != blank %}
            <h2 class="vb-main-collection__section-title">{{ section.settings.bundles_heading }}</h2>
          {% endif %}
          {% if section.settings.bundles_subheading != blank %}
            <p class="vb-main-collection__bundles-subheading">{{ section.settings.bundles_subheading }}</p>
          {% endif %}

          <div class="vb-main-collection__grid vb-main-collection__grid--bundles">
            {% assign bundle_index = 0 %}
            {% for product in collection.products %}
              {% assign tags_down = product.tags | join: ',' | downcase %}
              {% if tags_down contains 'bundle' %}
                {% assign bundle_index = bundle_index | plus: 1 %}
                {% assign is_popular_bundle = false %}
                {% if tags_down contains 'popular' or bundle_index == 1 %}
                  {% assign is_popular_bundle = true %}
                {% endif %}

                {% render 'product-card',
                  product: product,
                  is_bundle: true,
                  is_popular: is_popular_bundle,
                  popular_label: section.settings.popular_bundle_label,
                  cta_label: section.settings.bundle_cta_label
                %}
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if paginate.pages > 1 %}
        <nav class="vb-main-collection__pagination">
          {{ paginate | default_pagination }}
        </nav>
      {% endif %}
    {% endpaginate %}
  {% endif %}
</section>

<style>
  .vb-main-collection {
    padding-top: 48px;
    padding-bottom: 48px;
  }

  .vb-main-collection__hero {
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 24px;
    border: 1px solid #e8ece9;
  }

  .vb-main-collection__hero img {
    width: 100%;
    display: block;
    aspect-ratio: 16 / 6;
    object-fit: cover;
  }

  .vb-main-collection__header {
    margin-bottom: 24px;
  }

  .vb-main-collection__header h1 {
    margin: 0;
    font-size: clamp(1.8rem, 4vw, 2.6rem);
    line-height: 1.08;
    letter-spacing: -0.015em;
    color: #1d2b21;
  }

  .vb-main-collection__description {
    margin-top: 24px;
    color: #4d5e53;
    line-height: 1.6;
  }

  .vb-main-collection__section {
    margin-top: 24px;
  }

  .vb-main-collection__section-title {
    margin: 0 0 24px;
    font-size: clamp(1.2rem, 2.8vw, 1.8rem);
    color: #1d2b21;
  }

  .vb-main-collection__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
    align-items: stretch;
  }

  .vb-main-collection__bundles {
    margin-top: 48px;
  }

  .vb-main-collection__divider {
    height: 1px;
    width: 100%;
    background: #e7ece9;
    margin-bottom: 24px;
  }

  .vb-main-collection__bundles-subheading {
    margin: -8px 0 24px;
    color: #4d5e53;
    font-size: 0.96rem;
    line-height: 1.55;
  }

  .vb-main-collection__pagination {
    margin-top: 48px;
  }

  .vb-main-collection__pagination .pagination {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }

  .vb-main-collection__pagination a,
  .vb-main-collection__pagination span {
    border: 1px solid #d9e1db;
    border-radius: 10px;
    padding: 8px 12px;
    color: #264132;
    text-decoration: none;
    font-size: 0.9rem;
  }

  .vb-main-collection .vb-product-card {
    background: #ffffff;
    border: 1px solid #e3e9e4;
    border-radius: 14px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 100%;
    transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    position: relative;
  }

  .vb-main-collection .vb-product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(20, 34, 24, 0.06);
    border-color: #d9e1db;
  }

  .vb-main-collection .vb-product-card__badge,
  .vb-main-collection .vb-product-card__popular {
    position: absolute;
    top: 12px;
    z-index: 2;
    font-size: 0.72rem;
    line-height: 1;
    font-weight: 700;
    padding: 7px 10px;
    border-radius: 999px;
  }

  .vb-main-collection .vb-product-card__badge {
    left: 12px;
    background: #5a8139;
    color: #ffffff;
  }

  .vb-main-collection .vb-product-card__popular {
    right: 12px;
    background: #eaf2e6;
    color: #365528;
    border: 1px solid #cfe0c8;
  }

  .vb-main-collection .vb-product-card__image-link {
    display: block;
    position: relative;
    background: #f8faf8;
    padding: 24px;
  }

  .vb-main-collection .vb-product-card__image-wrap {
    display: block;
    position: relative;
  }

  .vb-main-collection .vb-product-card__image-link .vb-product-card__image,
  .vb-main-collection .vb-product-card__placeholder {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: contain;
    display: block;
  }

  .vb-main-collection .vb-product-card__image--primary,
  .vb-main-collection .vb-product-card__image--secondary {
    transition: opacity 0.24s ease;
  }

  .vb-main-collection .vb-product-card__image--secondary {
    position: absolute;
    inset: 0;
    opacity: 0;
  }

  @media (hover: hover) and (pointer: fine) {
    .vb-main-collection .vb-product-card:hover .vb-product-card__image--primary {
      opacity: 0;
    }

    .vb-main-collection .vb-product-card:hover .vb-product-card__image--secondary {
      opacity: 1;
    }
  }

  .vb-main-collection .vb-product-card__content {
    padding: 24px;
    display: grid;
    gap: 12px;
    flex: 1 1 auto;
    align-content: start;
  }

  .vb-main-collection .vb-product-card__title {
    margin: 0;
    font-size: 1.02rem;
    line-height: 1.35;
  }

  .vb-main-collection .vb-product-card__title a {
    color: #1d2b21;
    text-decoration: none;
  }

  .vb-main-collection .vb-product-card__savings {
    margin: 0;
    color: #3d6030;
    font-size: 0.86rem;
    font-weight: 700;
  }

  .vb-main-collection .vb-product-card__price-wrap {
    margin: 0;
    display: inline-flex;
    align-items: baseline;
    gap: 8px;
  }

  .vb-main-collection .vb-product-card__compare {
    font-size: 0.9rem;
    color: #7d8c82;
    text-decoration: line-through;
  }

  .vb-main-collection .vb-product-card__price {
    color: #1d2b21;
    font-size: 1.2rem;
    line-height: 1.2;
    letter-spacing: -0.01em;
  }

  .vb-main-collection .vb-product-card__cta {
    width: 100%;
    margin-top: 12px;
    text-align: center;
    text-decoration: none;
    background: #5a8139;
    color: #ffffff;
    border: 1px solid #5a8139;
    border-radius: 10px;
    min-height: 44px;
    padding: 10px 14px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 700;
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }

  .vb-main-collection .vb-product-card__cta:hover {
    background: #48682b;
    border-color: #48682b;
  }

  .vb-main-collection__grid--bundles .vb-product-card {
    border-color: #d8e2db;
  }

  .vb-main-collection__grid--bundles .vb-product-card__image-link {
    padding: 28px;
  }

  .vb-main-collection__grid--bundles .vb-product-card__content {
    padding: 28px;
    gap: 14px;
  }

  .vb-main-collection__grid--bundles .vb-product-card__title {
    font-size: 1.08rem;
  }

  .vb-main-collection__grid--bundles .vb-product-card__price {
    font-size: 1.28rem;
  }

  .vb-main-collection__grid--bundles .vb-product-card.is-popular {
    border-color: #c8dac4;
    box-shadow: 0 10px 22px rgba(23, 40, 27, 0.06);
  }

  @media (min-width: 750px) {
    .vb-main-collection__grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (min-width: 990px) {
    .vb-main-collection__grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
</style>

{% schema %}
{
  "name": "Main collection",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_collection_image",
      "label": "Show collection image",
      "default": true
    },
    {
      "type": "text",
      "id": "products_heading",
      "label": "Products heading",
      "default": "Productos"
    },
    {
      "type": "text",
      "id": "product_cta_label",
      "label": "Product CTA label",
      "default": "Agregar al carrito"
    },
    {
      "type": "text",
      "id": "bundles_heading",
      "label": "Bundles heading",
      "default": "Bundles recomendados"
    },
    {
      "type": "text",
      "id": "bundles_subheading",
      "label": "Bundles subheading",
      "default": "Ahorra mas combinando productos complementarios."
    },
    {
      "type": "text",
      "id": "bundle_cta_label",
      "label": "Bundle CTA label",
      "default": "Ver bundle"
    },
    {
      "type": "text",
      "id": "popular_bundle_label",
      "label": "Popular bundle label",
      "default": "Mas popular"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 6,
      "max": 36,
      "step": 3,
      "default": 12
    }
  ]
}
{% endschema %}
